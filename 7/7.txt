Практикалық жұмыс №7. Жасырын хабарларды бұзу (стегонализ) және анықтау тәсілдері

Мақсаты
Стеганография арқылы жасырылған хабарларды анықтау (стегоанализ) және ықтимал түрде ашу әдістерін меңгеру.
Статистикалық, визуалдық және құралдық тәсілдерді практикалық түрде қолдану.
Python және ашық кітапханалар арқылы автоматталған тексеріс-скрипттер жазу дағдыларын дамыту.
Қорытынды ретінде әртүрлі әдістердің артықшылықтары мен шектеулерін түсіну.

Теориялық кіріспе
Стеганография — тасымалдаушы файлға (сурет, аудио, видео, мәтін) хабарды жасырын енгізу; стегоанализ — осы жасырын хабардың бар-жоғын анықтау және мүмкін болса шығару. Стегонализ әдістері екі үлкен топқа бөлінеді: табиғи (visual, statistical) және тар (signature/known-method). Төменгі деңгейдегі LSB-стегожүйелерді анықтауға арналған классикалық тәсілдер: бит-гистограмма талдауы, χ² (chi-square) тест, RS-анализ, межпиксельдік корреляция (adjacent pixel correlation). JPEG/DCT тәсілдері үшін — DCT коэффициенттерінің таралуы мен Quantization матрицасына қатысты аномалияларды қарастыру. Аудио файлдарда спектрлік талдау, энтропия және шу деңгейлері (SNR) арқылы стегосигнал табуға болады; MP3/OGG сығымдауларда символдар жоғалуы мүмкін, сондықтан WAV қарапайым тасымалдаушы ретінде қолайлы. Бейнефайлдарда кадрлық статистика және кадрлар арасындағы қарапайым айырмашылық (frame differencing) көмектеседі. Сонымен қатар, метадеректерді (Exif, ID3 тегтері) тексеру жиі пайдалы — кейде жасырын ақпарат соларға жазылады. Қауіпсіздікше, стегонализ — детектор ретінде екі режимде жұмыс істейді: білу/білмеу ақпарат (known/unknown cover); белгілі әдісті (например LSB) білсеңіз, белсенді signature-based детекция тиімді; білмесеңіз — статистикалық тестілер қажет.

Қадамдық нұсқаулық (практикалық әдістер және Python мысалдары)
Қадам 0. Құралдар мен орта
Python 3.x, pip.
Пайдаланылатын пакеттер: pillow, numpy, scipy, matplotlib, opencv-python, stegano (опция), pydub (аудио).
pip install pillow numpy scipy matplotlib opencv-python stegano pydub
Жұмыс тек өз файлдарыңызда немесе зертханалық тазартылған мысалдарда жүргізілуі тиіс.

Қадам 1 — Визуалдық және гистограммалық талдау (суреттер)
Бастапқы суреттің және күдікті суреттің визуалын салыстырыңыз (зум, контраст арттыру). Кейде LSB енгізу көлеңкелерді өзгертуі мүмкін.
Пиксель гистограммасын салыңыз (R,G,B каналар бойынша). LSB енгізілген суретте гистограммада жұп/тактап кеміту байқалуы мүмкін.
Python мысалы — гистограмма салыстыру:
from PIL import Image
import numpy as np
import matplotlib.pyplot as plt
img = Image.open('suspect.png').convert('RGB')
arr = np.array(img)
for i, col in enumerate(['R','G','B']):
    channel = arr[:,:,i].flatten()
    plt.figure()
    plt.hist(channel, bins=256, color=col.lower(), alpha=0.7)
    plt.title(f'{col} histogram')
plt.show()
Не іздейсіз: гистограммада кездейсоқтықтың (бұзылған сыртқы формалардың) өзгерісі, екі шетteгі пиктерде аномалия.

Қадам 2 — LSB детекциясы (χ² тест және бит-жиілік)
LSB-қа қарсы өте жиі қолданылатын тест — χ² (chi-square) тесті; ол байттар жұптарының теңсіздігін тексереді (0/1 биттердің таралуы). Сонымен қатар биттер жиілігін (LSB distribution) тексеріңіз.
Қарапайым LSB-аналитика коды:
from PIL import Image
import numpy as np
def lsb_histogram(path):
    img = Image.open(path).convert('RGB')
    arr = np.array(img)
    lsb_counts = {0:0, 1:0}
    for i in range(3):
        channel = arr[:,:,i].flatten()
        lsb = channel & 1
        lsb_counts[0] += np.sum(lsb==0)
        lsb_counts[1] += np.sum(lsb==1)
    return lsb_counts
print(lsb_histogram('clean.png'))
print(lsb_histogram('suspect.png'))
Интерпретация: таза несиешіде LSB таралуы шамамен тең болуы керек (бірақ табиғи суретте де теңестірілмеуі мүмкін). LSB-ті өте айқын теңестіру жасырын хабардың бар екенін көрсетуі мүмкін.



Қадам 3 — RS-анализ (Regular/Singular)
RS-анализ LSB-стеганографияны анықтаудың классикалық статистикалық процедурасы. Ол пиксель түстерінің топтамаларында «регулярлы» және «сингулярлы» топтарды санайды; енгізу олардың қатынасын өзгертеді. Толық код күрделі, бірақ scipy/numpy арқылы жүзеге асырылады. (Практикалық курс үшін кітапханалық іске асыру қолдануға болады — іздеп табыңыз: stegdetect, steganalysis жобалары.)

Қадам 4 — JPEG / DCT негізіндегі талдау
JPEG суреттерінде хабарды DCT коэффициенттеріне енгізу жиі қолданылады. DCT-ке тән детекция:
Қуатты (low-frequency) және орташа/жоғарғы жиіліктердегі коэффициенттерді талдау;
Коэффициенттердің симметриясы/таратылуын салыстыру;
Quantization-нан кейінгі коэффициенттерде аномалиялар болуы мүмкін.
Python + OpenCV арқылы DCT коэффициенттерін қарау (бір кадр/блок үшін):
import cv2
import numpy as np
img = cv2.imread('suspect.jpg', cv2.IMREAD_GRAYSCALE)
# блоктық DCT (8x8)
h, w = img.shape
block = img[0:8,0:8].astype(np.float32) - 128
dct = cv2.dct(block)
print(dct)
Не іздейсіз: DCT коэффициенттерінде табиғи таралудан ауытқу, ерекше паттерндер.

Қадам 5 — Аудио талдау (спектр, энтропия, көрініс)
WAV файлда спектрлік талдау (FFT): жасырын хабар жиілік доменінде болуы мүмкін.
Шум/энергия профилін қарап, кенеттің (spike) бар-жоғын анықтаңыз.
SNR және Shannon энтропиясын есептеп, күдікті файлдар мен таза файлдарды салыстырыңыз.
Python мысалы (pydub + numpy FFT):
from pydub import AudioSegment
import numpy as np
audio = AudioSegment.from_wav('suspect.wav')
samples = np.array(audio.get_array_of_samples())
# моноға ауыстыру (егер стерео)
if audio.channels == 2:
    samples = samples.reshape((-1,2)).mean(axis=1)
fft = np.fft.fft(samples[:44100])  # алғашқы секунд
freqs = np.abs(fft)
Не іздейсіз: орташа спектрдан ауытқу, шамадан тыс пиктер.

Қадам 6 — Бейнефайлдарды талдау (кадрлар арасындағы корреляция)
Видеодан кадрларды бөліп алыңыз (OpenCV).
Қадрлар арасындағы абсолютті айырмашылықты есептеп, кадрлар жиынтығында ненормальды өзгерістерді (odd/even кадрларда жасырын дерек) іздеңіз.
Бірнеше кадрға бірдей биттерді енгізу бейнесінде қайталану болуы мүмкін — бұл индикатор.
OpenCV мысалы:
import cv2
cap = cv2.VideoCapture('suspect.mp4')
ret, prev = cap.read()
prev_gray = cv2.cvtColor(prev, cv2.COLOR_BGR2GRAY)
while True:
    ret, frame = cap.read()
    if not ret:
        break
    gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)
    diff = cv2.absdiff(gray, prev_gray)
    print('mean diff:', diff.mean())
    prev_gray = gray
cap.release()
Не іздейсіз: кадрлар арасындағы күтпеген ірі өзгерістер.

Қадам 7 — Метадеректер және қосымша артефакттарды тексеру
Суреттердің Exif, PNG тектерін, аудионың ID3 тегтерін тексеріңіз — кейде жасырын ақпарат сол жерде қалады.
Қосымша: файл соңында қосымша деректер (trailing data) бар-жоғын тексеріңіз: файл өлшемі мен формат нұсқауларына сәйкес келетінін қарап шығыңыз.
PNG/Exif тексеру мысалы:
from PIL import Image
img = Image.open('suspect.png')
print(img.info)  # metadata

Қадам 8 — Автоматтандырылған сканер жасау (pipeline)
Қолданушыға ыңғайлы сканер: визуалдық (гистограмма) → LSB статистикасы → DCT/FFT тесттер → метадеректер → кадр/спектрлік талдау. Әр тесттің нәтижесін шкаламен (score) бағалап, жалпы сенімділік көрсеткішін шығарыңыз.

Практикада мысалдар
Мысал 1 — LSB-логикадан табу: suspect_lsb.png файлын χ² және LSB таралуымен тексеріп, стегосигнал бар деген қорытындыға келу.
Мысал 2 — JPEG/DCT талдау: suspect_compressed.jpg файлында DCT коэффициенттерінде табиғи емес тармақтар бар — нәтижесінде DCT-стего болуы мүмкін.
Мысал 3 — Аудио спектрлік аномалия: suspect.wav файлының FFT-інде жоғарғы жиілікте кенет пик көрініп, ол суфле-кодталған хабардың белгісі болуы ықтимал.

Қорытынды
Стегонализ — бірнеше техника мен бақылаудың комбинациясы. Бір ғана тест сенімді қорытынды бермейді; статистикалық және визуалдық тестерді біріктіру қажет.
LSB әдісі ең көп тараған және салыстырмалы түрде анықтау оңай; DCT/Transform-бағытталған әдістер табылуы қиынырақ.
Аудио және видео үшін домендік талдау (спектр, кадраралық айырмашылық) маңызды.
Метадеректер мен trailing-data қарапайым, бірақ жиі ұмытылатын индикатор.
Әрқашан этика мен заң талаптарын сақтаңыз — тек өз немесе рұқсат етілген мәліметтерді талдаңыз.

Жеке практикалық тапсырмалар
clean.png пен suspect.png суреттерінің R, G, B гистограммаларын салыстырып, айырмашылықтарды сипаттаңыз.
LSB гистограммасын есептеп, екі сурет арасында LSB таралуының айырмашылығын бағалаңыз.
χ² тестін қолданып LSB-стегонің бар-жоғын анықтаңыз (Python-да scipy.stats.chisquare).
RS-анализ алгоритмінің принципін түсініп, қарапайым іске асыру задумасын жазыңыз (алгоритм қадамдарын сипаттаңыз).
JPEG файлының DCT коэффициенттерін шығарып, оларды таза JPEG-пен салыстырыңыз.
WAV файлдан FFT алып, күдікті спектрлік пикті талдаңыз.
MP3-тан WAV-қа конвертация жасап, жасырын дерек сақталып қалғанын тексеріңіз.
Видеодан әрбір 10-кадрды сақтап, кадраралық mean-diff графигін жасаңыз.
Exif/metadata мәліметтерін шығарып, кез-келген күдікті өрісті тауып көрсетіңіз.
Файлдың соңындағы trailing bytes бар-жоғын анықтау үшін hex-тексеру жүргізіңіз.
Логикалық тест: PNG файлының IDAT/тегтерін талдап, қосымша chunk бар-жоғын іздеңіз.
Суретті 50% сығыңыз (JPEG) — енгізілген хабар сақтала ма, сынап көріңіз.
Бір суретте LSB арқылы 1KB хабар енгізіп, қайта шығару сынағын жасаңыз; табу тиімділігін бағалаңыз.
Base64-пен кодталған мәтін сурет ішіндегі metadata-ға енгізілгенде табу қаншалықты оңай — тексеріңіз.
Қарапайым stego-ұстаушы құралды (stegano.lsb.reveal) пайдаланып, 10 түрлі суретті тексеріп көріңіз. Қайсысы позитив нәтиже береді.
Аудиода эхо-стегоні анықтау үшін autocorrelation есептеңіз.
WAV-тың жоғарғы жиіліктерін төмендетіп (low-pass), жасырын хабар жоғала ма — тексеріңіз.
DCT-ке негізделген стегоні анықтау үшін JPEG коэффициенттерінің энтропиясын есептеңіз.
Суреттегі пішіндік (shape) аймақтарда LSB енгізу айқындау оңай ма — салыстырыңыз (текстуралы vs тегіс аймақ).
GIF файлындағы кадрларды тексеріп, әр кадрда жасырын дерек бар-жоғын анықтаңыз.
PNG vs BMP форматтарында бірдей хабарды енгізіп, қайсысы оңай анықталатынын салыстырыңыз.
Кездейсоқ биттермен (noise) жасалған суретті талдап, детектор қалай жауап береді.
Күрделірек сценарий: суретте LSB-ны рандомизациялап енгізілген хабарды табу үшін қандай стратегиялар қолданасыз — жазыңыз.
Сигнатура- негізіндегі детектор жасаңыз: белгілі stego-құралдардың шығаратын паттерндерін анықтаңыз және тестілеңіз.
RS-анализді кітапханалық іске асырмасаңыз да, оның логикасын кодтық түрде симуляциялаңыз (кіші өлшемді матрица үшін).
Визуалдық айырмашылықтарды (difference image) жасап, heatmap құрыңыз; жасырын аймақтарды айқындаңыз.
Құжаттағы (DOCX) metadata мен қосымша бөлімдерді тексеріп, жасырын мәтін бар-жоғын анықтаңыз.
Қарапайым автоматталған сканер пайплайн жасап, бірнеше тест файлды өткізіп, нәтиже рейтингісін шығарыңыз.
Бір бейнефайлдан QR-кодты кадрларда қайталанатын екенін тауып, QR-дан мәтінді алу.
Қорытынды есеп дайындаңыз: қолданған әдістер, табу/жоқ болмау рейтингтері, ресурстар (уақыт/есептеу), әрі практикалық ұсыныстар (қалай қорғау керек).

